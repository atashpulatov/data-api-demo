job 'stage-1-dev' do
  description 'the first stage in the pipeline
designed to complete quickly, < 10 mins
produces and publishes a versioned deployment package'

  configure_common_items{}

  properties do
    office_365_connector do
      url 'https://microstrategy.webhook.office.com/webhookb2/634be0ba-786a-432d-aa12-ec0f76352e81@901c038b-4638-4259-b115-c1753c7735aa/IncomingWebhook/7b18118a42a64ea1a0d5cc9f2ccde920/89167fb2-af2d-467d-9dd9-b81339b8327a'
      notifySuccess         false
      notifyFailure         true
      notifyBackToNormal    false
      notifyRepeatedFailure true
    end
  end

  assigned_node_string 'rhel8_vra'

  triggers do
    github_push do
    end
  end

   build_wrappers do
    secret_text do
      credentialsId 'Tools'
      variable 'SRCCLR_API_TOKEN'
    end
  end

  builders do
    bash do
      script '#!/usr/bin/env bash
set +xe

export PATH=/usr/local/sbin:/usr/local/bin:$PATH

export WORKSPACE_SETTING=aws_dev

source .ecosystem
export HATS=$HATS:rallytask
rake pre_pipeline
rake veracode
rake build
rake upload_outputs_to_nexus[ci]
rake post_build_info_to_rally
rake update_ready_for_pr
rake post_pipeline
'
    end

    sonarqube do
      other_properties 'sonar.javascript.lcov.reportPaths=production/coverage/lcov.info
                        sonar.exclusions=**/_tests_/*,**/*.test.*
                        sonar.coverage.exclusions=**/public/*'
    end
  end

  publishers do
    parameterized_trigger do
      job_short_names %w{
        stage-2-e2e-browser-test-python-mac
        stage-2-e2e-browser-test-python-win
      }
    end
  end

end

