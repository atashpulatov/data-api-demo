job 'stage-2-e2e-browser-test-python-mac' do
  description 'run browser based e2e python test for excel plugin, on mac'

  configure_common_items{}

  properties do
    parameters do
      upstream_parameter do
        upstream_job_name 'stage-1-dev'
        name 'APPLICATION_VERSION'
        description 'the version of the application to deploy and test'
      end
    end

    office_365_connector do
      url 'https://microstrategy.webhook.office.com/webhookb2/634be0ba-786a-432d-aa12-ec0f76352e81@901c038b-4638-4259-b115-c1753c7735aa/IncomingWebhook/7b18118a42a64ea1a0d5cc9f2ccde920/89167fb2-af2d-467d-9dd9-b81339b8327a'
      notifySuccess         false
      notifyFailure         true
      notifyBackToNormal    false
      notifyRepeatedFailure true
    end
  end

  scm do
    git do
    end
  end

  assigned_node_string 'mstr-office-test-mac'

  builders do
    bash do
      script '#!/usr/bin/env bash
set +xe

export PATH=/usr/local/sbin:/usr/local/bin:$PATH
export TERM_PROGRAM=iTerm.app
export WORKSPACE_SETTING=mac_test

source .ecosystem
rake pre_pipeline
export HATS=pipeline:$HATS

rake py_e2e_test_mac[ci_pipeline_postmerge_mac_chrome, $APPLICATION_VERSION]
'
    end
  end

  publishers do
    html do
       report_name 'Mac Browser e2e Python Test Report'
       report_directory_path "tests/integration/python/allure-report"
       index_file_name 'index.html'
    end

    ext_mailer do
      recipients_list 'rraszplewicz@microstrategy.com,yzhuk@microstrategy.com'
      subject '$JOB_NAME - $BUILD_STATUS'
      content '$DEFAULT_CONTENT'
      fail_trigger_recipients_list ''
      fail_trigger_notify_developer 'true'
      always_trigger 'true'
      always_trigger_recipients_list ''
    end

  end

end

