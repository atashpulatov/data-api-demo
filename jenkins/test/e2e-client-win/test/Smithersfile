job 'stage-2-e2e-client-test-win' do
  description 'run client based e2e test for excel plugin, on windows'

  configure_common_items{}

  properties do
    inject do
      properties_content "MSYS=winsymlinks:nativestrict
        PATH=/usr/local/.rbenv/shims:/usr/local/ruby-install/bin:/usr/local/rbenv/libexec:/tools/msys/20160205-3/cmd:/tools/Sysinternals:/Users/vagrant/bin:/Users/vagrant/.rbenv/versions/2.2.4/bin:/cmd:/usr/local/bin:/mingw64/bin:/usr/bin:/Windows/system32:/Windows:/Windows/System32/Wbem:/Windows/System32/WindowsPowerShell/v1.0:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl:/c/Program\ Files/Amazon/AWSCLI"
    end
    
  end

  scm do
    git do
    end
  end

  assigned_node_string 'excel-windows-mock-node'

  builders do

    bash do
      script '#!/usr/bin/env bash
set +xe
export PATH=/usr/local/sbin:/usr/local/bin:$PATH
export WORKSPACE_SETTING=windows_test

source .ecosystem
export HATS=pipeline:$HATS

rake deploy_tester_server[$APPLICATION_VERSION]
rake start_web_application_driver
rake e2e_test_client
'
    end
  end

  publishers do
    html do
       report_name 'Client e2e Test Report'
       report_directory_path "tests\\integration\\test-driver-client\\target\\surefire-reports"
       index_file_name 'desktop.automation.functional.maintained.mvp.LogInLogOutTests.txt'
    end

    ext_mailer do
      recipients_list 'dtamosiunas@microstrategy.com,yzhai@microstrategy.com'
      subject '$JOB_NAME - $BUILD_STATUS'
      content '$DEFAULT_CONTENT'
      fail_trigger_recipients_list ''
      fail_trigger_notify_developer 'true'
      always_trigger 'true'
      always_trigger_recipients_list ''
    end
  
  end

end
