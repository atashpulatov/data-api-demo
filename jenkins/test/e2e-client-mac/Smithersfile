job 'stage-2-e2e-client-test-mac' do
  description 'run desktop based e2e test for excel plugin, on mac'

  configure_common_items{}

  properties do
    parameters do
      upstream_parameter do
        upstream_job_name 'stage-1-dev'
        name 'APPLICATION_VERSION'
        description 'the version of the application to deploy and test'
      end

    end
  end

  scm do
    git do
    end
  end

  assigned_node_string 'mstr-office-test'

  builders do
    bash do
      script '#!/usr/bin/env bash
set +xe

export PATH=/usr/local/sbin:/usr/local/bin:$PATH
export TERM_PROGRAM=iTerm.app
export WORKSPACE_SETTING=mac_test

source .ecosystem
export HATS=pipeline:$HATS

rake deploy_tester_server[$APPLICATION_VERSION]
rake e2e_test_client

'
    end
  end

  publishers do
 
    html do
      report_name 'Client Mac e2e Test Report'
      report_directory_path "tests/integration/test-driver-client/target/surefire-reports"
      index_file_name 'desktop.automation.functional.maintained.mvp.LogInLogOutTests.txt'
    end

    ext_mailer do
      recipients_list 'dhornos@microstrategy.com,yzhai@microstrategy.com,dtamosiunas@microstrategy.com'
      subject '$JOB_NAME - $BUILD_STATUS'
      content '$DEFAULT_CONTENT'
      fail_trigger_recipients_list ''
      fail_trigger_notify_developer 'true'
      always_trigger 'true'
      always_trigger_recipients_list ''
    end
  
  end

end
